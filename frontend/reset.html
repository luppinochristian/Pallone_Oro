<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Reset Password â€“ Golden Striker</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--bg1)">
    <div class="auth-box" style="max-width:400px;width:100%;padding:32px">
        <div class="auth-logo">
            <span class="ball">âš½</span>
            <h1>GOLDEN STRIKER</h1>
            <p>Reimposta la tua password</p>
        </div>
        <div id="reset-content">
            <div class="form-group">
                <label>Nuova Password</label>
                <input type="password" id="new-pass" placeholder="Minimo 6 caratteri" style="width:100%;padding:10px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--text)">
            </div>
            <div class="form-group">
                <label>Conferma Password</label>
                <input type="password" id="conf-pass" placeholder="Ripeti la password" style="width:100%;padding:10px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--text)">
            </div>
            <p class="error-msg" id="reset-err" style="color:#ff6b6b;margin:8px 0"></p>
            <button onclick="submitReset()" class="btn-primary" style="width:100%">ðŸ”‘ Reimposta Password</button>
        </div>
    </div>
</div>
<script>
const token = new URLSearchParams(location.search).get('token');
if (!token) document.getElementById('reset-content').innerHTML = '<p style="color:#ff6b6b">Link non valido.</p>';

async function submitReset() {
    const p1 = document.getElementById('new-pass').value;
    const p2 = document.getElementById('conf-pass').value;
    const err = document.getElementById('reset-err');
    if (p1.length < 6) { err.textContent = 'Password troppo corta'; return; }
    if (p1 !== p2)      { err.textContent = 'Le password non coincidono'; return; }
    const res = await fetch('/backend/api/auth.php?action=do_reset', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ token, password: p1 })
    }).then(r => r.json());
    if (res.success) {
        document.getElementById('reset-content').innerHTML = '<div style="color:#4caf50;text-align:center;padding:20px">âœ… Password aggiornata!<br><br><a href="/frontend/index.html" style="color:var(--gold)">Torna al gioco</a></div>';
    } else {
        err.textContent = res.error || 'Errore';
    }
}
</script>
</body>
</html>
